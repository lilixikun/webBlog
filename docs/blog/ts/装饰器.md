# è£…é¥°å™¨

è£…é¥°å™¨çš„ä½¿ç”¨éœ€è¦å¼€å¯ **tsconfig.json** çš„ experimentalDecoratorsã€emitDecoratorMetadata å±æ€§

## ç±»çš„è£…é¥°å™¨

è£…é¥°å™¨æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•° ç±»è£…é¥°å™¨æ¥å—çš„å‚æ•°æ˜¯**æ„é€ å‡½æ•°** ç±»è£…é¥°å™¨ç”¨ **@** ç¬¦å·æ¥ä½¿ç”¨

å¦‚ä¸‹æˆ‘ä»¬ç»™ç±»åˆ›å»ºä¸€ä¸ªç®€å•çš„è£…é¥°å™¨

```ts
function testDecorator(flag: boolean) {
    constructor.prototype.getName = () => {
        console.log('testDecorator è£…é¥°å™¨')
    }
}

@testDecorator(true)
class Test {}

const test = new Test();
(test as any).getName()
```

æ‰§è¡Œå‘ç° æ­£å¸¸æ‰“å°,ç°åœ¨æˆ‘ä»¬å†å»æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨

```ts
function testDecorator1(constructor: any) {
    console.log('Decorator1');
}
```

ä½¿ç”¨å¦‚ä¸‹:
```ts
@testDecorator
@testDecorator1
class Test {}
```
> è£…é¥°å™¨ä»ä¸‹å¾€ä¸Šæ‰§è¡Œ,ä»å³å¾€å·¦æ‰§è¡Œ
è¿è¡Œå‘ç° æ‰“å°äº† "Decorator1",æˆ‘ä»¬å¹¶æ²¡æœ‰å®ä¾‹åŒ– Test,å¯æ˜¯ä¾ç„¶æ‰§è¡Œäº†,è¯´æ˜äº†è£…é¥°å™¨æ˜¯åœ¨ç±»å®šä¹‰çš„æ—¶å€™å°±æ‰§è¡Œäº†ã€‚

æˆ‘ä»¬ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚,å°±æ˜¯æ ¹æ®ç‰¹å®šçš„æ¡ä»¶å»æ‰§è¡Œè£…é¥°å™¨,è¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ° **å·¥å‚æ¨¡å¼æ¥** è§£å†³

## è£…é¥°å™¨å·¥å‚

å¯ä»¥é€šè¿‡åŒ…è£…ä¸€å±‚å‡½æ•°å†è¿”å›ä¸€ä¸ªå‡½æ•°çš„å½¢å¼å»å®ç°,å¦‚ä¸‹:

```js
function myDecorator(flag: boolean) {
    if (flag) {
        return function (constructor: any) {
            constructor.prototype.getName = () => {
                console.log("æˆ‘æ˜¯è£…é¥°å™¨å·¥å‚åˆ›å»ºçš„");
            }
        }
    } else {
        return function (constructor: any) { }
    }
}
```
ä¼ å…¥ flag ,æ‰§è¡Œå¦‚ä¸‹:

```ts
@myDecorator(false)
class Test {}

const test = new Test();
(test as any).getName()
```

å¯ä»¥çœ‹åˆ°,ä¼ å…¥ **false** æ‰§è¡Œä¼šæŠ¥é”™ï¼Œä¼ å…¥ **true** ä¼šæ­£å¸¸æ‰§è¡Œ,ä¸è¿‡ä½ ä¹Ÿèƒ½å‘ç°åœ¨ä½¿ç”¨ **.** çš„ä½¿ç”¨å¹¶ä¸ä¼šæç¤º getName æ–¹æ³•,è¿˜éœ€è¦æˆ‘ä»¬ æ–­è¨€ä¸€ä¸‹,ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨æ›´é«˜çº§çš„æ–¹æ³•è§£å†³

```ts
function testDecorator() {
    return function <T extends new (...args: any[]) => any>(constructor: T) {
        return class extends constructor {
            name = "aotu";
            getName() {
                return this.name
            }
        }
    }
}

const Test = testDecorator()(
    class {
        name: string;
        constructor(name: string) {
            this.name = name
        }
    }
)

const test = new Test('xk')
console.log(test.getName());
```
ç°åœ¨å†è°ƒç”¨æ–¹æ³•,å‘ç°æœ‰æç¤ºäº†

## æ–¹æ³•è£…é¥°å™¨

ç°åœ¨ç»™ç±»çš„æ–¹æ³•æ·»åŠ ä¸€ä¸ªè£…é¥°å™¨,å¦‚ä¸‹:

```ts
function getNameDecorator(targt: any, key: string, descriptor: PropertyDescriptor) {
    console.log(targt, key);
}

class Test {
    name: string;
    constructor(name: string) {
        this.name = name
    }
    @getNameDecorator
    getName() {
        return this.name
    }
}
```

è£…é¥°å™¨æ–¹æ³•ä¼šæ¥å—ä¸‰ä¸ªæ–¹æ³•
- targt æ™®é€šæ–¹æ³• å¯¹åº”çš„æ˜¯ç±»çš„ prototype é™æ€æ–¹æ³• å¯¹åº”çš„æ˜¯ç±»æ„é€ å‡½æ•°
- key å½“å‰çš„å±æ€§å è¿™é‡Œå°±æ˜¯ getName
- descriptor æˆå‘˜çš„å±æ€§æè¿°

å¦‚ä¸‹,é€šè¿‡ **descriptor** æ”¹å†™ getName å‡½æ•°

```ts
...
descriptor.value = function () {
    return 1
}
const test = new Test('aotu')
console.log(test.getName());
```
æ‰“å°å‘ç°æ”¹å˜æ–¹æ³•å·²ç»è¢«æ”¹å†™äº†

## è®¿é—®å™¨è£…é¥°å™¨

```ts
function setDecorator(targt: any, key: string, descriptor: PropertyDescriptor) {
    console.log(descriptor);
    descriptor.writable = false
}

class Test {
    private _age: number;
    constructor(age: number) {
        this._age = age
    }

    @setDecorator
    get age() {
        return this._age
    }

    set age(age: number) {
        this._age = age
    }
}

const test = new Test(20)
test.age = 30
console.log(test.age);
```
å‘ç°æŠ¥é”™,æˆ‘ä»¬è§„å®šäº†ä¸èƒ½é‡å†™,å› è€Œä¸èƒ½é‡å†™
> æ–¹æ³•è£…é¥°å™¨çš„ descriptor æœ‰ **value** å’Œ **witable** å±æ€§ï¼Œä½†æ²¡æœ‰ **get** å’Œ **set** å±æ€§ï¼›è®¿é—®å™¨è£…é¥°å™¨æœ‰ **get** å’Œ **set** å±æ€§ï¼Œä½†æ²¡æœ‰ **value** å’Œ **witable** å±æ€§ã€‚

## å±æ€§è£…é¥°å™¨

```ts
function nameDecorator(target: any, key: string): any {
    const descriptor: PropertyDescriptor = {
        writable: false
    }
    return descriptor;
}
class Test1 {
    @nameDecorator
    name = "aotu";
}
const test1 = new Test1()
```
å±æ€§è£…é¥°å™¨ å‡½æ•°åªæ¥æ”¶ä¸¤ä¸ªå‚æ•°,å¯ä»¥è¿”å› **descriptor**,å¯¹å±æ€§åŠ ä»¥ä¿®é¥°

## å‚æ•°è£…é¥°å™¨

```ts
function paramDecorator(target: any, method: string, paramIndex: number) {
    console.log(target, method, paramIndex);
}

class Test {
    getInfo(name: string, @paramDecorator age: number) {
        console.log(name, age);
    }
}

const test = new Test();
test.getInfo('aotu', 30); 
```

- target å¯¹åº”çš„ prototype
- method æ–¹æ³•å
- paramIndex å‚æ•°æ‰€åœ¨çš„ä½ç½®

## è£…é¥°å™¨ä½¿ç”¨ğŸŒ°
