# æ‰“é€ å±äºè‡ªå·±çš„è„šæ‰‹æ¶

## åˆå§‹åŒ–é¡¹ç›®

```
mkdir aotu-cli
npm init -y
npm install eslint husky -D
```

åˆå§‹åŒ– eslint é…ç½®æ–‡ä»¶

```
npm eslint --init
```
ä¾æ¬¡é€‰æ‹©

```shell
To check syntax and find problems
CommonJS (require/exports)
None of these
Does your project use TypeScript?(Y/n) n
Where does your code run? Node
What format do you want your config file to be in? JSON
```
é…ç½®å®Œå,é¡¹ç›®æ ¹ç›®å½•ä¼šç”Ÿæˆ **.eslintrc.json**


## æ·»åŠ é…ç½®æ–‡ä»¶

**åˆ›å»º bin\www æ–‡ä»¶ å…¨å±€å‘½åæ‰§è¡Œæ ¹æ–‡ä»¶**, å†™å…¥ä»¥ä¸‹:

```js
#!/usr/bin/env node     
console.log('aotu-cli')
```
**#!/usr/bin/env node** è¡¨ç¤ºæˆ‘è¦ç”¨ç³»ç»Ÿä¸­çš„è¿™ä¸ªç›®å½•/user/bin/envçš„nodeç¯å¢ƒæ¥æ‰§è¡Œæ­¤æ–‡ä»¶ï¼Œä¸”éœ€è¦æ³¨æ„å¿…é¡»æ”¾åœ¨æ–‡ä»¶å¼€å¤´

åœ¨ **package.json** ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®:

```shell
"bin": {
    "aotu": "./bin/www"
}
```

## npm link

link å°†ä¸€ä¸ªä»»æ„ä½ç½®çš„ npm åŒ…é“¾æ¥åˆ°å…¨å±€æ‰§è¡Œç¯å¢ƒï¼Œä»è€Œåœ¨ä»»æ„ä½ç½®ä½¿ç”¨å‘½ä»¤è¡Œéƒ½å¯ä»¥ç›´æ¥è¿è¡Œè¯¥npmåŒ…ã€‚ npm linkå‘½ä»¤é€šè¿‡é“¾æ¥ç›®å½•å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ç°npmåŒ…å‘½ä»¤çš„å…¨å±€å¯æ‰§è¡Œ

```
npm link
```
åœ¨ç»ˆç«¯ æ‰§è¡Œ **aotu**

å‘ç° å±å¹•è¾“å‡ºäº† aotu-cli

## ç¼–å†™ Cli

åœ¨  bin/www æ–‡ä»¶ å¼•å…¥ main.js ä½œä¸ºæˆ‘ä»¬é¡¹ç›®å…¥å£

```
#!/usr/bin/env node
require('../src/main.js')
```

## ä½¿ç”¨ commander

commander æ˜¯npmä¾èµ–æ’åå‰åä¹‹ä¸€çš„æ¨¡å—,ä¸»è¦ä½œç”¨ä¸ºå‘½ä»¤è¡Œè¾…åŠ©

å®‰è£…æ¨¡å—

```
npm install commander
```

åœ¨ src/main.js  å†™äº›ä¸œè¥¿

```js
const program = require('commander');

const _version = require('../package.json').version;

const program = require('commander');
program.version(_version)
       .parse(process.argv);
```

åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ **aotu-cli -help**,å‘ç°æœ‰ä¸¤ä¸ªå‘½åå‘½åæ‰§è¡Œä¸‹ **aotu-cli -V**

å‘ç°æ‰“å°äº† ç‰ˆæœ¬å· **1.0.0**

ä¸‹é¢æˆ‘ä»¬æ¥ç©ç‚¹èŠ±çš„ ğŸ¶

å®‰è£… figlet ç”Ÿæˆä¸€äº›ç‰¹æ®Šçš„æ–‡å­—

```
npm install figlet
```

å®‰è£… @darkobits/lolcatjs ç”Ÿæˆé¢œè‰²

```
npm install @darkobits/lolcatjs
```
ä¿®æ”¹ main.js

```js
const figlet = require('figlet');
const versionStr = figlet.textSync('Aotu');
const Printer = require('@darkobits/lolcatjs')

program.version(
    Printer.default.fromString(
        `   \n      å¸­å¤çš„æ‰‹æ¶${_version}\n    www.47.98.161.153:8082 \n${versionStr}`
    ))

program.parse(process.argv);
```

è®©æˆ‘ä»¬å†æ‰§è¡Œä¸€æ¬¡  **auto -v**

å‘ç°æ§åˆ¶å°ç”Ÿæˆäº† èŠ±é‡Œèƒ¡å“¨ ğŸ¶

![aotu.png](/engineering/aotu-v.png)

æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¼€å§‹æ¥å—ç”¨æˆ·å‘½ä»¤è¡Œçš„è¾“å…¥


## æ–°å»ºå‘½å

```
npm install inquirer chalk ora shelljs download-git-repo
```

**inquirer** äº¤äº’å¼å‘½ä»¤è¡Œ,å¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº¤äº’

**chalk** nodeç»ˆç«¯æ ·å¼åº“

**ora**  Node.js ç»ˆç«¯åŠ è½½åŠ¨ç”»æ•ˆæœ

**shelljs** Nodejsä½¿ç”¨ShellJSæ“ä½œç›®å½•æ–‡ä»¶

**download-git-repo** ä»gitä»“åº“ä¸‹è½½ä»£ç 

æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€äº›å‘½å

```js
program.option('init', 'åˆå§‹åŒ–é¡¹ç›®ğŸ”§', 'blue')
    .option('json2ts', 'è¾“å…¥æ¥å£åœ°å€,è‡ªåŠ¨ç”ŸæˆTypeScriptç±» ğŸ¥±')
```

æ¥æ”¶å‘½å


```js
program
    .usage(`${chalk.green('<cmd>')} <options>`)
    .arguments('<cmd> [env]')
    .action(function (cmd, ages) {
        const handler = bindHandler[cmd];
        if (typeof handler === 'undefined') {
            ora(chalk.red(`å‘½ä»¤${cmd}:`) + chalk.red('æš‚æœªæ”¯æŒ')).fail();
        } else {
            handler(ages);
        }
    });
```

ä½¿ç”¨ **inquirer** å®šä¹‰ä¸€äº›æ“ä½œ

```js
const prompt = [
    {
        type: 'input',
        name: 'projectName',
        message: 'è¯·è¾“å…¥é¡¹ç›®å‘½åğŸ˜„',
        filter: function (val) {
            return val
        }
    },
    {
        type: 'list',
        name: 'jskind',
        message: 'è¯·é€‰æ‹©ä½¿ç”¨çš„æ¨¡æ¿',
        default: 0,
        choices: [
            {
                name: 'ECMAScript6',
                value: 'es6',
                url: '123'
            }, {
                name: 'TypeScript',
                value: 'ts',
                url: '456'
            }
        ]
    }
]
```

å°è£… **bindHandler** å¯¹å¯¹åº”çš„å‘½åå°±æ˜¯æ“ä½œ

```js
const bindHandler = {
    init() {
        inquirer.prompt(questions).then(answers => {
            projectName = answers.projectName
            const _pwd = process.cwd();
            // ç”¨æˆ·å…¨è·¯å¾„
            projectPath = `${_pwd}/${projectName}`;
            // æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
            checkAppName(projectPath, projectName)

            const spinner = ora(`â° ${chalk.red('downloading template')}`).start();
            // é¡¹ç›®æ¨¡ç‰ˆåœ°å€
            const url = `direct:https://github.com/LiLixikun/${answers.jskind}.git`;
            // æ‰§è¡Œä¸‹è½½ä»»åŠ¡
            download(url, projectPath, { clone: true }, function (err) {
                spinner.stop();
                if (err) {
                    console.log(chalk.red('ä¸‹è½½å¤±è´¥ ğŸ˜­'));
                    process.exit(-1)
                } else {
                    spinner.succeed(`${chalk.green('ä¸‹è½½æˆåŠŸ ğŸ˜„')}`)
                    // ä¿®æ”¹é¡¹ç›®åç§°
                    shell.sed(
                        '-i',
                        'aotu',
                        projectName,
                        projectPath + '/package.json'
                    );
                }
            });

        }).catch(error => {
            console.log(chalk.red('è„šæ‰‹æ¶å‡ºç°å¼‚å¸¸,è¯·è”ç³» xx ğŸ“§'));
        })
    },
    json2ts() {
        createServer()
    }
}
```

ç°åœ¨æˆ‘ä»¬åœ¨ç»ˆç«¯æ¥éªŒè¯ä¸‹

![aotu-init.png](/engineering/aotu-init.png)


å¦‚ä½•ä¾èµ–æŸä¸ªåº“ä½†æ˜¯å‘å¸ƒçš„æ—¶å€™ä¸å‘å¸ƒå®ƒå‘¢ï¼Ÿ
é…ç½® pack.json  

```json
  "peerDependencies": {
    "react": "^0.14.0 || ^15.0.0 || ^16.0.0",
    "react-dom": "^0.14.0 || ^15.0.0 || ^16.0.0"
  }
```


ä¸‹ä¸€ç« èŠ‚æˆ‘ä»¬ä»‹ç»å¦‚ä½•æ­å»ºå¯è§†åŒ–ç•Œé¢æ“ä½œ