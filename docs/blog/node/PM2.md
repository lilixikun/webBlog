# PM2

PM2 æ˜¯ node è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ç®€åŒ–å¾ˆå¤šnodeåº”ç”¨ç®¡ç†çš„ç¹çä»»åŠ¡ï¼Œå¦‚æ€§èƒ½ç›‘æ§ã€è‡ªåŠ¨é‡å¯ã€è´Ÿè½½ å‡è¡¡ç­‰ï¼Œè€Œä¸”ä½¿ç”¨éå¸¸ç®€å•ã€‚

[pm2å®˜ç½‘](https://pm2.io/)

## åˆ›å»ºè¿›ç¨‹çš„æ–¹æ³•

1. **fork**
2. **exec**

## pm2åŸç†

```js
// master
var cluster = require('cluster');
var numCPUs = require('os').cpus().length;

if (cluster.isMaster) {
    console.log(numCPUs);
    for (var i = 0; i < numCPUs; i++) {
        var worker = cluster.fork();
    }
} else {
    require("./app.js");
}
// app.js
// worker
var http = require('http');
http.createServer(function(req, res) {
    res.writeHead(200);
    res.end("hello world\n");
}).listen(8000);
```

pm2 ä¼šæ ¹æ®ç”µè„‘çš„ cpus ä¸ªæ•°å» fork å¯¹åº”çš„è¿›ç¨‹æ•°ï¼ŒNode å¤šè¿›æˆé»˜è®¤ä¼šé‡‡ç”¨æŠ¢å ç­–ç•¥ã€‚

::: warning ç–‘é—®ğŸ¤”ï¸
å¦‚ä½•æ£€æµ‹å­è¿›ç¨‹æ˜¯å¦å¤„äºæ­£å¸¸æ´»è·ƒçŠ¶æ€ï¼Ÿ
:::

**é‡‡ç”¨å¿ƒè·³æ£€æµ‹**ï¼Œæ¯éš”æ•°ç§’å‘å­è¿›ç¨‹å‘é€å¿ƒè·³åŒ…ï¼Œå­è¿›ç¨‹å¦‚æœä¸å›å¤ï¼Œé‚£ä¹ˆè°ƒç”¨killæ€æ­»è¿™ä¸ªè¿›ç¨‹
ç„¶åå†é‡æ–° **cluster.fork()** ä¸€ä¸ªæ–°çš„è¿›ç¨‹

::: warning ç–‘é—®ğŸ¤”ï¸
å­è¿›ç¨‹å‘å‡ºå¼‚å¸¸æŠ¥é”™ï¼Œå¦‚ä½•ä¿è¯ä¸€ç›´æœ‰ä¸€å®šæ•°é‡å­è¿›ç¨‹ï¼Ÿ
:::

å­è¿›ç¨‹å¯ä»¥ç›‘å¬åˆ°é”™è¯¯äº‹ä»¶ï¼Œè¿™æ—¶å€™å¯ä»¥å‘é€æ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼Œè¯·æ±‚æ€æ­»è‡ªå·±
å¹¶ä¸”ä¸»è¿›ç¨‹æ­¤æ—¶é‡æ–°è°ƒç”¨ **cluster.fork** ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹


æˆ‘ä»¬å¯ä»¥ä¾èµ– **Nginx**+**pm2**+**docker**æ¥å®ç°è‡ªåŠ¨åŒ–+ç›‘æ§éƒ¨ç½²ï¼Œ